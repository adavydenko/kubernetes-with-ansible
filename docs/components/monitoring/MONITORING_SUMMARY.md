# üìä Monitoring System - –°–≤–æ–¥–∫–∞

## üéØ –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

### 1. –†–æ–ª—å Ansible (`monitoring/`)
- **`defaults/main.yml`** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **`tasks/main.yml`** - –∑–∞–¥–∞—á–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- **`README.md`** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:
- **Prometheus** - —Å–±–æ—Ä –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
- **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–∞—à–±–æ—Ä–¥—ã
- **Node Exporter** - –º–µ—Ç—Ä–∏–∫–∏ —É–∑–ª–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞
- **Alertmanager** - –≥–æ—Ç–æ–≤ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∞–ª–µ—Ä—Ç–æ–≤

### 3. –ü—Ä–∏–º–µ—Ä—ã –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- **`examples/monitoring-alerts.yml`** - –ø—Ä–∏–º–µ—Ä—ã –∞–ª–µ—Ä—Ç–æ–≤
- **`scripts/test-monitoring.sh`** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç
- **`QUICK_START_MONITORING.md`** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
ansible-playbook -i inventory.yml site.yml --tags monitoring
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
./scripts/test-monitoring.sh
```

### –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º
```bash
# Prometheus
kubectl port-forward -n monitoring svc/prometheus 9090:9090
# http://localhost:9090

# Grafana
kubectl port-forward -n monitoring svc/grafana 3000:3000
# http://localhost:3000 (admin/admin123)
```

## ‚úÖ –ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è

### –£–∑–ª—ã –∫–ª–∞—Å—Ç–µ—Ä–∞:
- CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –ü–∞–º—è—Ç—å (RAM)
- –î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
- –°–µ—Ç–µ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### Kubernetes:
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –°–æ–±—ã—Ç–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Prometheus –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
- URL: `http://prometheus.monitoring.svc.cluster.local:9090`

### 2. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–∞—à–±–æ—Ä–¥—ã:
- **Kubernetes Cluster Monitoring** (ID: 315)
- **Node Exporter Dashboard** (ID: 1860)
- **Prometheus Stats** (ID: 3662)

## üö® –ê–ª–µ—Ä—Ç—ã

### –ì–æ—Ç–æ–≤—ã–µ –∞–ª–µ—Ä—Ç—ã:
- –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU (>80%)
- –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (>85%)
- –ù–∏–∑–∫–æ–µ –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ (<10%)
- –£–∑–ª—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
- –ü–æ–¥—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ crash loop
- –°–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–ª–µ—Ä—Ç–æ–≤:
```bash
kubectl apply -f examples/monitoring-alerts.yml
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```yaml
prometheus_enabled: true
grafana_enabled: true
node_exporter_enabled: true
monitoring_storage_class: "local-storage"
```

### –†–µ—Å—É—Ä—Å—ã:
- **Prometheus**: 512Mi-1Gi RAM, 250m-500m CPU
- **Grafana**: 128Mi-256Mi RAM, 100m-200m CPU
- **Node Exporter**: 64Mi-128Mi RAM, 50m-100m CPU

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
monitoring/
‚îú‚îÄ‚îÄ defaults/main.yml          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ tasks/main.yml             # –ó–∞–¥–∞—á–∏ Ansible
‚îî‚îÄ‚îÄ README.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

examples/
‚îî‚îÄ‚îÄ monitoring-alerts.yml      # –ü—Ä–∏–º–µ—Ä—ã –∞–ª–µ—Ä—Ç–æ–≤

scripts/
‚îî‚îÄ‚îÄ test-monitoring.sh         # –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

QUICK_START_MONITORING.md      # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
MONITORING_SUMMARY.md          # –≠—Ç–∞ —Å–≤–æ–¥–∫–∞
```

## üõ† –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–æ–≤
kubectl get pods -n monitoring

# –õ–æ–≥–∏ Prometheus
kubectl logs -n monitoring deployment/prometheus

# –õ–æ–≥–∏ Grafana
kubectl logs -n monitoring deployment/grafana

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
kubectl exec -n monitoring deployment/prometheus -- wget -qO- http://localhost:9090/api/v1/query?query=up
```

## üìà –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã Prometheus

### CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```
100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)
```

### –ü–∞–º—è—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```
(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100
```

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–æ–≤:
```
count(kube_pod_info)
```

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏–∑ 10 –º–∞—à–∏–Ω

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ retention** - 15 –¥–Ω–µ–π –¥–ª—è Prometheus
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ** - –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞—Å—Ç—É—Ç –±—ã—Å—Ç—Ä–æ
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã** - –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** - –≤–µ—Ä—Å–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
5. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±—ç–∫–∞–ø—ã** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Grafana

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **Monitoring —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**
2. üîÑ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã –≤ Grafana**
3. üîÑ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã**
4. üîÑ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø**
5. üîÑ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±—ç–∫–∞–ø—ã –º–µ—Ç—Ä–∏–∫**
6. üîÑ **–î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏**

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Prometheus Documentation](https://prometheus.io/docs/)
- [Grafana Documentation](https://grafana.com/docs/)
- [Kubernetes Monitoring Best Practices](https://kubernetes.io/docs/tasks/debug-application-cluster/resource-usage-monitoring/)
